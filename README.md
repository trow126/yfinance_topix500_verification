バックテスト計画書
1. 目的

提案された投資戦略（権利確定日前に買い → 配当受取 → 配当落ちで買い増し → 窓埋めで決済）が、過去のTOPIX500採用銘柄において、どの程度のパフォーマンス（リターン、リスク）を示したかを定量的に評価する。
戦略の有効性、潜在的なリスク、および改善の余地を特定する。
2. テスト対象

対象銘柄: TOPIX500採用銘柄。
留意点: テスト期間中の銘柄入れ替えを考慮する必要があります。J-Quants APIでヒストリカルな構成銘柄リストが取得可能か確認し、可能な限りテスト開始時点または各年の採用銘柄リストに基づいて対象を選定します。難しい場合は、テスト期間開始時点でTOPIX500に採用されていた銘柄群を対象とします（生存者バイアスに注意が必要）。
テスト期間: 市場の様々な局面（上昇、下落、レンジ相場）を含む十分な期間を設定します。
例: 2014年1月1日 ～ 2023年12月31日（約10年間）
J-Quants スタンダードプランで取得可能なデータ期間を確認し、それに合わせて調整してください。
3. 使用データ (J-Quants API スタンダードプランより取得)

株価データ: 日足四本値（始値、高値、安値、終値）、出来高。
配_info情報: 1株あたり配当金額、権利確定日、権利落ち日。
銘柄情報: TOPIX500採用銘柄リスト（上記「対象銘柄」の留意点参照）。
データ取得期間: 上記テスト期間に準じます。
データの前処理:
欠損値の処理（例: 前日終値で補完、または対象から除外）。
株式分割・併合の調整（J-Quants APIが調整済み株価を提供しているか、または調整係数を提供しているか確認し、適切に処理する）。今回は配当イベントがトリガーとなるため、配当落ち自体は株価の調整として扱わず、実際の株価変動と配当情報を使用します。
4. 戦略ルールとパラメータ

初期エントリー（買い）：
タイミング: 各銘柄の権利確定日のN営業日前（例: N=3）。
株数: 1銘柄あたり固定金額（例: 100万円）で買えるだけの単元株数。または最小単元。
配当獲得: 権利確定日をまたいで株式を保有。
買い増し（権利落ち日）：
条件: 権利落ち日の株価が、権利落ち前最終売買日の終値よりも下落した場合。
タイミング: 権利落ち日の終値（または翌日始値）。
株数: 初期投資株数と同数、または初期投資額のM%相当額（例: M=50%）。
決済（売り）：
窓埋め達成: 株価（終値）が権利落ち前最終売買日の終値水準以上に戻った最初の営業日の終値（または翌日始値）。
最大保有期間（損切り）： 権利落ち日からX営業日経過しても窓埋めしない場合は決済（例: X=20営業日）。
損切りライン: 買い増し後の平均取得単価からY%下落した場合に決済（例: Y=10%）。
資金管理:
ポートフォリオ全体の初期資金を設定（例: 1000万円）。
1銘柄への初期投資額の上限を設定（上記「株数」で定義）。
同時にポジションを持つ銘柄数の上限は、まずは設けずにテストし、必要に応じて設定。
5. 取引コストの考慮

売買手数料: 往復で考慮。証券会社の手数料体系を参考に設定（例: 1取引あたり固定額、または約定代金に対する一定割合）。
スリッページ: 売買価格に対して不利な方向に一定割合（例: 0.1%）または固定ティックを加味してシミュレーション。
6. バックテストの実施手順

J-Quants APIから必要なデータを取得・整形する（スタンダードプランのAPI呼び出し制限に注意し、効率的なデータ取得方法を設計する。例: 一括取得、ローカル保存）。
テスト期間内の各営業日について、対象銘柄の権利確定日情報をチェック。
エントリー条件を満たした銘柄を買い付け。
権利落ち日に買い増し条件をチェックし、該当すれば買い増し。
保有銘柄について、日々決済条件（窓埋め、最大保有期間、損切りライン）をチェックし、該当すれば売却。
全ての取引記録（銘柄、売買日時、価格、株数、手数料、スリッページ、損益など）をログとして保存。
期間終了後、または全ポジション決済後にパフォーマンスを評価。
7. 評価指標

リターン関連:
総リターン (Total Return)
年率リターン (Annualized Return)
プロフィットファクター (Profit Factor = 総利益 / 総損失)
勝率 (Win Rate)
ペイオフレシオ (Payoff Ratio = 平均利益 / 平均損失)
1取引あたりの平均損益
リスク関連:
最大ドローダウン (Max Drawdown)
シャープレシオ (Sharpe Ratio) (無リスク金利を設定)
ソルティノレシオ (Sortino Ratio)
ボラティリティ (Volatility)
その他:
総取引回数
平均保有期間
買い増し後の勝率変化
窓埋め達成までの平均日数
8. 感度分析と検証

パラメータ変更: N (エントリータイミング)、M (買い増し比率)、X (最大保有期間)、Y (損切り率) などの主要パラメータをいくつか変更し、パフォーマンスがどのように変化するかを確認。
注意: カーブフィッティングを避けるため、過度な最適化は行わず、ロバスト性（頑健性）の確認に留める。
期間分割テスト: テスト期間を複数に分割し（例: 前半と後半）、各期間で同様の傾向が見られるか確認する。
9. バックテスト実施上の注意点

API利用制限: J-Quants スタンダードプランのAPI呼び出し回数、データ取得量制限を遵守する。必要に応じて処理を分割したり、待機時間を設けたりする。
**生存者バイアス:**可能な限り、テスト期間開始時点のTOPIX500構成銘柄、または期間を通じてのヒストリカルな構成銘柄データを使用するよう努める。
先読みバイアス: 売買判断は、その判断時点までに知り得た情報のみに基づいて行うようロジックを厳密に構築する。
コードの正確性: バックテストプログラムのロジック、計算式の正確性を十分に検証する（少量のデータで手計算との照合など）。
結果の解釈: バックテスト結果はあくまで過去のデータに基づくものであり、将来の成果を保証するものではないことを常に意識する。統計的な有意性も考慮に入れる（取引回数が少ない場合など）。
10. 報告と次のステップ

バックテスト結果をグラフや表を用いて整理し、客観的に分析・考察する。
戦略の有効性、リスク特性、改善点などを明確にする。
結果が良好で、戦略に一定の合理性が見出せる場合は、フォワードテスト（ペーパートレードまたは少額での実運用）への移行を検討する。